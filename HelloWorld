public static async Task WriteCsvAsync(Stream outputStream, IEnumerable<dynamic> records)
{
    var config = new CsvConfiguration(CultureInfo.InvariantCulture)
    {
        IgnoreBlankLines = true,
    };

    using var writer = new StreamWriter(outputStream);
    using var csvWriter = new CsvWriter(writer, config);

    // Convert dynamic records to a list of dictionaries
    var recordList = records.Select(record => (IDictionary<string, object>)record).ToList();

    // Write records to CSV
    foreach (var record in recordList)
    {
        foreach (var kvp in record)
        {
            csvWriter.WriteField(kvp.Value);
        }
        await csvWriter.NextRecordAsync();
    }
}
